# Default values for nlweb.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount:
  frontend: 2
  backend: 2
  backendUtilities: 1

image:
  backend:
    repository: neotys/neoload-web-backend
    pullPolicy: IfNotPresent
  frontend:
    repository: neotys/neoload-web-frontend
    pullPolicy: IfNotPresent
  backendUtilities:
    repository: neotys/neoload-web-backend-utilities
    pullPolicy: IfNotPresent

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name:

#podSecurityContext:
#  fsGroup: 2000

securityContext:
  capabilities:
     drop:
     - ALL
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  # readOnlyRootFilesystem: true
  # runAsUser: 2000

services:
  webapp:
    host: 
    type: ClusterIP
    port: 80
    ingress:
      paths: ["/"]
  api:
    host: 
    type: ClusterIP
    port: 80
    ingress:
      paths: ["/"]
  api-v4:
    host:
    type: ClusterIP
    port: 80
    ingress:
      paths:
        - /v4
  files:
    host: 
    type: ClusterIP
    port: 80
    ingress:
      paths: ["/"]

resources:
  backend:
    requests:
      cpu: 1
      memory: 3Gi
    limits:
      cpu: 2
      memory: 3Gi
  frontend:
    requests:
      cpu: 50m
      memory: 100Mi
    limits:
      memory: 100Mi
  backendUtilities:
    requests:
      cpu: 500m
      memory: 2Gi
    limits:
      memory: 2Gi

# NLWeb configuration
neoload:
  labels:
    backend: {}
    frontend: {}
    backendUtilities: {}
  annotations:
    backend: {}
    frontend: {}
    backendUtilities: {}
  configuration:
    backend:
      mongo:
        host: 
        port: 27017
        poolSize: 50
      java:
        xmx: 2000m
      misc:
        maxFormAttributeSize: 32768
        files:
          maxUploadSizeInBytes: "250000000"
          maxUploadPerWeek: "250"
      ## Licensing token that will be stored in chart-managed Secret
      licensingPlatformToken:
      ## Use pre-existing Secret (must have "licensingPlatformToken" key). This takes precedence over "licensingPlatformToken".
      licensingPlatformTokenExistingSecret: 
      livenessProbe:
        initDelaySeconds: 120
      readinessProbe:
        initDelaySeconds: 120
    frontend:
      livenessProbe:
        initDelaySeconds: 10
      readinessProbe:
        initDelaySeconds: 10
    backendUtilities:
      livenessProbe:
        initDelaySeconds: 20
      readinessProbe:
        initDelaySeconds: 20
      java:
        xmx: 300m
    ha:
      mode: "API"
    ## Secret key that will be stored in chart-managed Secret
    secretKey: 
    ## Use pre-existing Secret (must have "nlwSecretKey" + "internalTokenSecret" keys). This takes precedence over "secretKey".
    secretKeyExistingSecret: 
    sendUsageStatistics: true

### MongoDB user configuration
mongodb:
  ## Use pre-existing secret for MongoDB username and password (must have "username" + "password" keys)
  existingSecret: 
  ## Create a secret with MongoDB username and password (requires "mongodbUsername" and "mongodbPassword" to be set)
  usePassword: true
  mongodbUsername: 
  mongodbPassword: 

### 
clusterRbac:
  enabled: true

nodeSelector: {}

tolerations: []

affinity: {}


### Logging configuration
loggerConfiguration: |-
  <configuration scan="true" scanPeriod="30 seconds">
    <shutdownHook />
    <appender name="STDOUT_PROD" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d [%thread] %-5level %logger{36} - %msg%n%X%n
            </pattern>
        </encoder>
    </appender>
    <appender name="ASYNC_PROD" class="ch.qos.logback.classic.AsyncAppender">
        <appender-ref ref="STDOUT_PROD" />
    </appender>
    <logger name="com.neotys" level="INFO" additivity="false">
        <appender-ref ref="ASYNC_PROD" />
    </logger>
    <logger name="com.neotys.MyLogger" level="INFO" additivity="false">
        <appender-ref ref="ASYNC_PROD" />
    </logger>
    <root level="info">
        <appender-ref ref="ASYNC_PROD" />
    </root>
  </configuration>